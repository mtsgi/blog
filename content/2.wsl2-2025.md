---
title: WSL2環境セットアップ2025年版
tags:
  - wsl2
  - zsh
  - fzf
date: 2025-08-13
---

以前Qiitaで[WSL2環境構築の記事](https://qiita.com/mtsgi/items/8a844870f30b30ef21e4)を書きましたが、いろいろと環境が変わっているので改めて2025年現在のセットアップをまとめます。

## WSL2のインストール

まずはPowerShellでWSL自体のインストールを行います

```bash
wsl --install
```

インストール完了後、PCを再起動します。

次に、Microsoft Storeからディストリビューションをインストールできます。

今回はUbuntu 24を選びました。

> Ubuntu 24.04.1 LTS
>
> <https://apps.microsoft.com/detail/9nz3klhxdjp5?hl=ja-JP&gl=JP>

すると、自動的にWindows Terminalにプロファイルが追加されます。

※ ここで、WSLがまだインストールされていない場合は下記のメッセージが表示され、その場でインストールすることもできます。

> Linux 用 Windows サブシステムがインストールされていません。'wsl.exe --install' を実行してインストールできます。

![スクリーンショット 2025-08-12 032018.png](/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%202025-08-12%20032018.png)

起動するとインストールが行われ、UNIXのユーザー名／パスワードを入力して設定完了です。

WSLのデフォルトがWSL2になっているので手動での変換作業などは不要です。

## Homebrewのインストール

パッケージマネージャーとしてHomebrewをインストールします。

> Homebrew on Linux
>
> <https://docs.brew.sh/Homebrew-on-Linux>

ホームページにある下記コマンドでHomebrewをインストールします。

```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

インストール完了後、下記のように表示されます。

> \==> Next steps:
>
> \- Run these commands in your terminal to add Homebrew to your PATH:
>
> echo >> /home/mtsgi/.bashrc
>
> echo 'eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"' >> /home/mtsgi/.bashrc
>
> eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
>
> \- Install Homebrew's dependencies if you have sudo access:
>
> sudo apt-get install build-essential
>
> For more information, see:
>
> <https://docs.brew.sh/Homebrew-on-Linux>
>
> \- We recommend that you install GCC:
>
> brew install gcc
>
> \- Run brew help to get started
>
> \- Further documentation:
>
> <https://docs.brew.sh>

下記の3行を実行して、PATHを通します。(ユーザー名の部分は自分のユーザー名で)

```bash
echo >> /home/mtsgi/.bashrc
echo 'eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"' >> /home/mtsgi/.bashrc
eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
```

次に、aptでHomebrewに必要なパッケージをインストールしていきます。

```bash
sudo apt-get update
sudo apt-get install build-essential
```

`brew doctor` を実行してみて、問題なければHomebrewのインストールはOKです。

## zshのインストール

Homebrewを使ってzshをインストールします。

```bash
brew install zsh
```

次に、デフォルトのシェルをzshにします。

`etc/shells` にzshのパスを書き込み、`chsh` でデフォルトのシェルを変更します。

```bash
which zsh | sudo tee -a /etc/shells
chsh -s /home/linuxbrew/.linuxbrew/bin/zsh
```

`zsh` コマンドを実行するか、WSL2を立ち上げなおすとzshが起動します。

しかし、zshにはまだbrewのパスが通っていないので通してあげる必要があります。

`~/.zshrc` に下記を追記します。

```text [.zshrc]
# Homebrew
eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
```

最初はファイルがまだ存在していなかったので `vi .zshrc` して作成しました。

zshを再起動後、`brew doctor` を実行してみて、問題なければOKです。

## Starshipのインストール

> Starship
>
> <https://starship.rs/ja-JP/>

こちらもHomebrewからインストールします。

```bash
brew install starship
```

インストール完了後、 `~/.zshrc` に下記を追記します。

```text [.zshrc]
# Starship
eval "$(starship init zsh)"
```

その後zshを再起動すると、Starshipが反映されています。

次に、Starshipのconfigを設定していきます。ひとまず下記コマンドを実行して設定ファイルを作成します。

```bash
mkdir -p ~/.config && touch ~/.config/starship.toml
```

設定は自分で一から書くこともできますが、プリセットが用意されているのでそれを持ってくることもできます。

今回は「Jetpack」プリセットを使うことにしました。

```bash
starship preset jetpack -o ~/.config/starship.toml
```

![スクリーンショット 2025-08-12 040212.png](/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%202025-08-12%20040212.png)

これでStarshipの設定は完了です。

## fzfの導入

コマンド履歴のインクリメンタルサーチをするため `fzf` を導入します。

下記の記事を参考にさせていただきました。

> zshでfzfを使ってコマンドと移動履歴を検索する
>
> <https://zenn.dev/nokogiri/articles/ec99e40df54555>

```bash
brew install fzf
```

その後、 `.zshrc` にコマンド履歴保存用の設定と、Ctrl+Rで履歴検索を行うfunctionの設定を追記します。

```js
# History
HISTFILE=~/.zsh_history
HISTSIZE=100000
SAVEHIST=100000
setopt share_history
setopt hist_ignore_dups
setopt hist_ignore_all_dups
setopt hist_ignore_space
setopt hist_reduce_blanks

# fzf history
function fzf-select-history() {
    BUFFER=$(history -n -r 1 | fzf --query "$LBUFFER" --reverse)
    CURSOR=$#BUFFER
    zle reset-prompt
}
zle -N fzf-select-history
bindkey '^r' fzf-select-history
```

ここまでで、基本的なターミナル環境の構築は完了です。

以降は開発環境の構築になります。

## Voltaの導入

Node, npm等のバージョン管理ツールとして、Voltaをインストールします。

> Volta - The Hassle-Free JavaScript Tool Manager
>
> <https://volta.sh/>

```bash
curl https://get.volta.sh | bash
```

zshを再起動し、 `volta -v` を実行してVoltaのバージョンが表示されればOKです。

### GCMの設定

Windows側のGit Credential Managerを呼び出してGitの認証をできるようにするため、Ubuntu側で下記の設定を行います

※ Git for Windowsのインストールが必要です

```bash
git config --global credential.helper "/mnt/c/Program\ Files/Git/mingw64/bin/git-credential-manager.exe"
```
